---
title: Clinical Triage Platform | Post Service Definition
keywords: servicedefinition, rest,
tags: [rest,fhir,api]
sidebar: ctp_rest_sidebar
permalink: api_post_service_definition.html
summary: Post a Service Definition
---

{% include custom/search.warnbanner.html %}

{% include custom/fhir.referencemin.html resource="" userlink="" page="" fhirname="Service Definition" fhirlink="[Service Definition](http://hl7.org/fhir/stu3/servicedefinition.html)" content="User Stories" userlink="" %}


## Post Service Definition Interaction ##
This is an operation performed by the Encounter Management System (EMS). It is an evaluate operation to request clinical decision support guidance from a selected Clinical Decision Support System (CDSS).   

## Request Headers ##
The following HTTP request headers are supported for this interaction:  


| Header               | Value |Conformance |
|----------------------|-------|-------|
| `Accept`      | The `Accept` header indicates the format of the response the client is able to understand, this will be one of the following <code class="highlighter-rouge">application/fhir+json</code> or <code class="highlighter-rouge">application/fhir+xml</code>. See the RESTful API [Content types](development_general_api_guidance.html#content-types) section. | MAY |
| `Authorization`      | <!--The `Authorization` header will carry the base64url encoded JSON web token required for audit on the spine - see [Access Tokens and Audit (JWT)](integration_access_tokens_and_audit_JWT.html) for details.-->Placeholder |  <!--MUST-->Placeholder |
| `fromASID`           | <!--Client System ASID-->Placeholder | <!--MUST-->Placeholder |
| `toASID`             | <!--The Spine ASID-->Placeholder | <!--MUST-->Placeholder |


## POST ServiceDefinition ##

### Get first question ###
Initially, the EMS retrieves the required first question from the CDSS.   
The operation is performed by an HTTP POST command as shown:  

<div markdown="span" class="alert alert-success" role="alert">
POST [base]/ServiceDefinition/[id]/$evaluate</div>  
The EMS will provide further input parameters for the $evaluate operation, in addition to the requestId and patient parameters already populated, for example that the context is use by an NHS 111 Call Handler. 
Further information about the [$evaluate operation](http://hl7.org/fhir/servicedefinition-operations.html#evaluate) is available.

## Response from CDSS ##

### Success ###

* SHALL return a <code class="highlighter-rouge">200</code> **OK** HTTP status code on successful execution of the operation.
* SHALL return a <code class="highlighter-rouge">GuidanceResponse</code> resource with a reference to a question, using the <code class="highlighter-rouge">Questionnaire</code> resource with a particular questionnaire identifier (identifier generated by CDSS provider). 

<!--What is the response in event of a failure?-->

## Get Questionnaire ##
The [EMS retrieves the question](api_get_questionnaire.html) from the CDSS.  

### User interaction ###
On receipt of the question from the CDSS, the EMS user obtains a response from the patient or his/her representative and this response is used to update the parameters to be sent for evaluation by the CDSS.

## EMS returns response to first question to CDSS ##
The EMS performs a further HTTP POST command to the CDSS  
<div markdown="span" class="alert alert-success" role="alert">
POST [base]/ServiceDefinition/[id]/$evaluate</div>
In this interaction, the EMS sends the response to the previous question in the form of a QuestionnaireResponse as a reference within the inputData parameter of the $evaluate operation.  

## Response from CDSS ##

### Success ###

* SHALL return a <code class="highlighter-rouge">200</code> **OK** HTTP status code on successful execution of the operation.
* SHALL return a <code class="highlighter-rouge">GuidanceResponse</code> resource with
    * a reference to a question, using the <code class="highlighter-rouge">Questionnaire</code> resource with a particular questionnaire identifier (identifier generated by CDSS provider). 
    * an assertion, based on the previous response given by the EMS to the first question, using the <code class="highlighter-rouge">Observation</code> resource (identifier generated by CDSS provider). 

## Get next question interactions ##
The cycle of interactions between the EMS and the CDSS continues, with parameters being continually updated and added to until all questions have been responded to.

## Final EMS $evaluate interaction ##
Once all data requirements have been fulfilled as described in the CDSS Service Definition, a final request is made for a disposition. 
The final $evaluate request contains all the data requirements based on all the previous answers, as InputData parameters for this submission. 
Each of the InputData parameters is an Observation resource where each flag is set to 'final'.

## Final CDSS Response ##
* SHALL return a <code class="highlighter-rouge">200</code> **OK** HTTP status code on successful execution of the operation.
* SHALL return a <code class="highlighter-rouge">GuidanceResponse</code> resource with
    * a reference to a <code class="highlighter-rouge">CarePlan</code> resource describing how one or more practitioners intend to deliver care for a particular patient OR  
    * a reference to a <code class="highlighter-rouge">RequestGroup</code> resource representing a group of optional activities that may be performed for a specific patient or context.

## Parameters ##
The $evaluate operation has a number of parameters which may be optionally included in the operation:

### IN Parameters ###

<table style="min-width:100%;width:100%">
<tr>
    <th style="width:25%;">Name</th>
    <th style="width:15%;">Cardinality</th>
    <th style="width:20%;">Type</th>
      <th style="width:40%;">Documentation</th>
</tr>

<tr>
    <td><code class="highlighter-rouge">requestId</code></td>
    <td><code class="highlighter-rouge">0..1</code></td>
    <td>id</td>
    <td>An optional client-provided identifier to track the request.</td>

</tr>
<tr>
    <td><code class="highlighter-rouge">evaluateAtDateTime</code></td>
        <td><code class="highlighter-rouge">0..1</code></td>
    <td>dateTime</td>
    <td>An optional date and time specifying that the evaluation should be performed as though it was the given date and time. The most direct implication of this is that references to "Now" within the evaluation logic of the module should result in this value. In addition, wherever possible, the data accessed by the module should appear as though it was accessed at this time. The evaluateAtDateTime value may be any time in the past or future, enabling both retrospective and prospective scenarios. If no value is provided, the date and time of the request is assumed.</td>

</tr>
<tr>
    <td><code class="highlighter-rouge">inputParameters</code></td>
        <td><code class="highlighter-rouge">0..1</code></td>
    <td>Parameters</td>
    <td>The input parameters for a request, if any. These parameters are defined by the module that is the target of the evaluation, and typically supply patient-independent information to the module.</td>

</tr>
<tr>
    <td><code class="highlighter-rouge">inputData</code></td>
     <td><code class="highlighter-rouge">0..1</code></td>
    <td>Any</td>
    <td>The input data for the request. These data are defined by the data requirements of the module and typically provide patient-dependent information.</td>
   
</tr> 
<tr>
    <td><code class="highlighter-rouge">patient</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
    <td>Reference(Patient)</td>
    <td>The patient in context, if any.</td>
 </tr>
<tr>
   <td><code class="highlighter-rouge">encounter</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
    <td>Reference(Encounter)</td>
    <td>The encounter in context, if any.</td>
  </tr>
<tr>
    <td><code class="highlighter-rouge">initiatingOrganization</code></td>
        <td><code class="highlighter-rouge">0..1</code></td>
    <td>Reference(Organization)</td>
    <td>The organization initiating the request.</td>
  </tr>
<tr>
    <td><code class="highlighter-rouge">initiatingPerson</code></td>
        <td><code class="highlighter-rouge">0..1</code></td>
    <td>Reference(Patient|Practitioner|RelatedPerson)</td>
    <td>The person initiating the request.</td>
  </tr>
<tr>
    <td><code class="highlighter-rouge">userType</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
    <td>CodeableConcept</td>
    <td>The type of user initiating the request, e.g. patient, healthcare provider, or specific type of healthcare provider (physician, nurse, etc.).</td>
 </tr>
<tr>
    <td><code class="highlighter-rouge">userLanguage</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
    <td>CodeableConcept</td>
    <td>Preferred language of the person using the system.</td>
 </tr>
<tr>
   <td><code class="highlighter-rouge">userTaskContext</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
     <td>CodeableConcept</td>
    <td>The task the system user is performing, e.g. laboratory results review, medication list review, etc. This information can be used to tailor decision support outputs, such as recommended information resources.</td>
  </tr>
<tr>
    <td><code class="highlighter-rouge">receivingOrganization</code></td>
        <td><code class="highlighter-rouge">0..1</code></td>
  <td>Reference(Organization)</td>
    <td>The organization that will receive the response.</td>
  </tr>
<tr>
    <td><code class="highlighter-rouge">receivingPerson</code></td>
        <td><code class="highlighter-rouge">0..1</code></td>
    <td>Reference(Patient|Practitioner|RelatedPerson)</td>
    <td>The person in the receiving organization that will receive the response.</td>
  </tr>
<tr>
    <td><code class="highlighter-rouge">recipientType</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
    <td>CodeableConcept</td>
    <td>The type of individual that will consume the response content. This may be different from the requesting user type (e.g. if a clinician is getting disease management guidance for provision to a patient). E.g. patient, healthcare provider or specific type of healthcare provider (physician, nurse, etc.).</td>
 </tr>
<tr>
   <td><code class="highlighter-rouge">recipientLanguage</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
     <td>CodeableConcept</td>
    <td>Preferred language of the person that will consume the content.</td>
  </tr>
<tr>
   <td><code class="highlighter-rouge">setting</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
     <td>CodeableConcept</td>
    <td>The current setting of the request (inpatient, outpatient, etc).</td>
  </tr>
<tr>
    <td><code class="highlighter-rouge">settingContext</code></td>
      <td><code class="highlighter-rouge">0..1</code></td>
    <td>CodeableConcept</td>
    <td>Additional detail about the setting of the request, if any.</td>
 </tr>
</table>

### OUT Parameters ###
<table style="min-width:100%;width:100%">
<tr>
    <th style="width:25%;">Name</th>
    <th style="width:15%;">Cardinality</th>
    <th style="width:20%;">Type</th>
      <th style="width:40%;">Documentation</th>
</tr>
<tr>
    <td><code class="highlighter-rouge">return</code></td>
      <td><code class="highlighter-rouge">1..1</code></td>
    <td>GuidanceResponse</td>
    <td>The result of the request as a GuidanceResponse resource.  
Note: as this the only out parameter, it is a resource, and it has the name 'return', the result of this operation is returned directly as a resource</td>
 </tr>
</table>


<!--
### Failure ###
The following errors can be triggered when performing this operation:  

<!--More errors are likely to be needed once we are clear on which search parameters are defined-->

* [Invalid parameter](api_general_guidance.html#parameters)
* [No record found](api_general_guidance.html#resource-not-found---servicedefinition)-->

## Example Scenario ##
<!--Placeholder -->













